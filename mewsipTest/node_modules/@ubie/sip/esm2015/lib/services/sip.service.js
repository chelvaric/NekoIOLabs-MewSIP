/**
 * @fileoverview added by tsickle
 * Generated from: lib/services/sip.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { UA } from 'sip.js/lib/UA';
import * as i0 from "@angular/core";
export class SipService {
    constructor() { }
    //accept an incomming call
    /**
     * @return {?}
     */
    acceptCall() {
        if (this.IncommingCallSession != undefined) {
            this.IncommingCallSession.accept();
        }
    }
    //refuse a call thats incomming
    /**
     * @return {?}
     */
    refuseCall() {
        if (this.IncommingCallSession != undefined) {
            this.IncommingCallSession.close();
        }
    }
    ///set the config for the sip, makes a user agent that will be used to recieve calls and more
    /**
     * @param {?} config
     * @return {?}
     */
    setConfig(config) {
        //make the options
        /** @type {?} */
        var options = {
            uri: config.Uri,
            authorizationUser: config.UserName,
            displayName: config.DisplayName,
            transportOptions: {
                wsServers: [config.WebsocketUrl]
            },
            password: config.Password
        };
        //create the client
        this.UserAgent = new UA(options);
    }
    //register the events  on the user agent were interested in
    /**
     * @private
     * @return {?}
     */
    registerAgentEvents() {
        this.UserAgent.on('invite', (/**
         * @param {?} session
         * @return {?}
         */
        (session) => this.inviteCallBack(session)));
        this.UserAgent.on('registrationFailed', (/**
         * @param {?=} response
         * @param {?=} cause
         * @return {?}
         */
        (response, cause) => this.registerFailedCallBack(response, cause)));
        this.UserAgent.on('registered', (/**
         * @param {?=} response
         * @return {?}
         */
        (response) => this.registeredCallBack(response)));
    }
    /**
     * @private
     * @param {?=} response
     * @return {?}
     */
    registeredCallBack(response) {
        if (this.OnRegistered != undefined) {
            this.OnRegistered.emit(true);
        }
    }
    /**
     * @private
     * @param {?=} response
     * @param {?=} reason
     * @return {?}
     */
    registerFailedCallBack(response, reason) {
        if (this.OnRegistered != undefined) {
            this.OnRegistered.emit(false);
        }
    }
    /**
     * @private
     * @param {?} session
     * @return {?}
     */
    inviteCallBack(session) {
        if (session != undefined) {
            this.registerInviteEvents(session);
            this.IncommingCallSession = session;
            this.OnIncommingCall.next(session.contact);
        }
    }
    /**
     * @private
     * @param {?} session
     * @return {?}
     */
    registerInviteEvents(session) {
        session.on('trackAdded', (/**
         * @return {?}
         */
        () => this.trackAddedCallback()));
    }
    /**
     * @private
     * @return {?}
     */
    trackAddedCallback() {
        //check if the session isn't undefined
        if (this.IncommingCallSession != undefined) {
            //get the peerConnection
            /** @type {?} */
            var peerConnection = this.IncommingCallSession.sessionDescriptionHandler['peerConnection'];
            //make media
            /** @type {?} */
            let media = new MediaStream();
            //get audio and video track from remote
            peerConnection.getReceivers().forEach((/**
             * @param {?} receiver
             * @return {?}
             */
            function (receiver) {
                media.addTrack(receiver.track);
            }));
            this.OnMediaRecieved.emit(media);
            return this.IncommingCallSession;
        }
    }
}
SipService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
SipService.ctorParameters = () => [];
/** @nocollapse */ SipService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function SipService_Factory() { return new SipService(); }, token: SipService, providedIn: "root" });
if (false) {
    /** @type {?} */
    SipService.prototype.OnRegistered;
    /** @type {?} */
    SipService.prototype.OnIncommingCall;
    /** @type {?} */
    SipService.prototype.OnMediaRecieved;
    /**
     * @type {?}
     * @private
     */
    SipService.prototype.UserAgent;
    /**
     * @type {?}
     * @private
     */
    SipService.prototype.IncommingCallSession;
    /**
     * @type {?}
     * @private
     */
    SipService.prototype.InCall;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2lwLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdWJpZS9zaXAvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvc2lwLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFnQixNQUFNLGVBQWUsQ0FBQztBQUV6RCxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sZUFBZSxDQUFDOztBQVFuQyxNQUFNLE9BQU8sVUFBVTtJQW9CckIsZ0JBQWdCLENBQUM7Ozs7O0lBSWpCLFVBQVU7UUFFUixJQUFHLElBQUksQ0FBQyxvQkFBb0IsSUFBSSxTQUFTLEVBQ3pDO1lBQ0UsSUFBSSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sRUFBRSxDQUFDO1NBQ3BDO0lBQ0gsQ0FBQzs7Ozs7SUFHRCxVQUFVO1FBRVIsSUFBRyxJQUFJLENBQUMsb0JBQW9CLElBQUksU0FBUyxFQUN6QztZQUNFLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQztTQUNuQztJQUNILENBQUM7Ozs7OztJQUdELFNBQVMsQ0FBQyxNQUFnQjs7O1lBSWxCLE9BQU8sR0FBZTtZQUN4QixHQUFHLEVBQUUsTUFBTSxDQUFDLEdBQUc7WUFDZixpQkFBaUIsRUFBRSxNQUFNLENBQUMsUUFBUTtZQUNsQyxXQUFXLEVBQUUsTUFBTSxDQUFDLFdBQVc7WUFDL0IsZ0JBQWdCLEVBQUU7Z0JBQ2hCLFNBQVMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUM7YUFDakM7WUFDRCxRQUFRLEVBQUUsTUFBTSxDQUFDLFFBQVE7U0FFMUI7UUFDRCxtQkFBbUI7UUFDbkIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNyQyxDQUFDOzs7Ozs7SUFHTyxtQkFBbUI7UUFFdkIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsUUFBUTs7OztRQUFDLENBQUMsT0FBMkIsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsRUFBQyxDQUFDO1FBQzFGLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLG9CQUFvQjs7Ozs7UUFBQyxDQUFDLFFBQWMsRUFBQyxLQUFXLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxRQUFRLEVBQUMsS0FBSyxDQUFDLEVBQUMsQ0FBQztRQUNwSCxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxZQUFZOzs7O1FBQUMsQ0FBQyxRQUFjLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxRQUFRLENBQUMsRUFBQyxDQUFDO0lBQzFGLENBQUM7Ozs7OztJQUVPLGtCQUFrQixDQUFDLFFBQWM7UUFFdkMsSUFBRyxJQUFJLENBQUMsWUFBWSxJQUFJLFNBQVMsRUFDakM7WUFDRSxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUM5QjtJQUNILENBQUM7Ozs7Ozs7SUFFTyxzQkFBc0IsQ0FBQyxRQUFjLEVBQUMsTUFBWTtRQUV4RCxJQUFHLElBQUksQ0FBQyxZQUFZLElBQUksU0FBUyxFQUNqQztZQUNFLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQy9CO0lBQ0gsQ0FBQzs7Ozs7O0lBRU8sY0FBYyxDQUFDLE9BQTJCO1FBRWhELElBQUcsT0FBTyxJQUFJLFNBQVMsRUFDdkI7WUFDRSxJQUFJLENBQUMsb0JBQW9CLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDbkMsSUFBSSxDQUFDLG9CQUFvQixHQUFHLE9BQU8sQ0FBQztZQUNwQyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDNUM7SUFDSCxDQUFDOzs7Ozs7SUFFTyxvQkFBb0IsQ0FBQyxPQUEyQjtRQUVyRCxPQUFPLENBQUMsRUFBRSxDQUFDLFlBQVk7OztRQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxFQUFDLENBQUE7SUFDNUQsQ0FBQzs7Ozs7SUFFTyxrQkFBa0I7UUFFeEIsc0NBQXNDO1FBQ3RDLElBQUcsSUFBSSxDQUFDLG9CQUFvQixJQUFJLFNBQVMsRUFDekM7OztnQkFHTSxjQUFjLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLHlCQUF5QixDQUFDLGdCQUFnQixDQUFDOzs7Z0JBR3RGLEtBQUssR0FBRyxJQUFJLFdBQVcsRUFBRTtZQUU1Qix1Q0FBdUM7WUFDeEMsY0FBYyxDQUFDLFlBQVksRUFBRSxDQUFDLE9BQU87Ozs7WUFBQyxVQUFVLFFBQVE7Z0JBQ3RELEtBQUssQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2pDLENBQUMsRUFBQyxDQUFDO1lBRUgsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFHakMsT0FBTyxJQUFJLENBQUMsb0JBQW9CLENBQUM7U0FDbEM7SUFDSCxDQUFDOzs7WUE1SEYsVUFBVSxTQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25COzs7Ozs7O0lBTUMsa0NBQW9DOztJQUdwQyxxQ0FBc0M7O0lBR3RDLHFDQUEyQzs7Ozs7SUFHM0MsK0JBQXFCOzs7OztJQUVyQiwwQ0FBaUQ7Ozs7O0lBRWpELDRCQUF1QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSW52aXRlU2VydmVyQ29udGV4dCwgSW52aXRlQ2xpZW50Q29udGV4dCB9IGZyb20gJ3NpcC5qcy9saWIvU2Vzc2lvbic7XG5pbXBvcnQgeyBVQSB9IGZyb20gJ3NpcC5qcy9saWIvVUEnO1xuaW1wb3J0IHsgU2Vzc2lvbkRlc2NyaXB0aW9uSGFuZGxlciB9IGZyb20gJ3NpcC5qcy9saWIvc2Vzc2lvbi1kZXNjcmlwdGlvbi1oYW5kbGVyJztcbmltcG9ydCB7IFNpcENvbmZpZyB9IGZyb20gJy4uL2ludGVyZmFjZXMvc2lwLWNvbmZpZyc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFNpcFNlcnZpY2Uge1xuXG4gIC8vZXZlbnRzXG5cbiAgLy90aGlzIGV2ZW50IGdldHMgdHJpZ2dlcmVkIHdoZW4gdGhlIHVzZXIgaXMgcmVnaXN0ZXJlZCB0byB0aGUgc2lwIHNlcnZlclxuICBPblJlZ2lzdGVyZWQ6IEV2ZW50RW1pdHRlcjxib29sZWFuPjtcblxuICAvL3RoaXMgZXZlbnQgaXMgdHJpZ2dlcmVkIHdoZW4gd2UgcmVjaWV2ZSBhIGNhbGxcbiAgT25JbmNvbW1pbmdDYWxsOiBFdmVudEVtaXR0ZXI8c3RyaW5nPjtcblxuICAvL3RoaXMgZXZlbnQgaXMgdHJpZ2dlcmVkIHdoZW4gdGhlIG1lZGlhIHN0cmVhbSBpcyByZWFkeSB0byBiZSBhdHRhY2hlZCB0byBhIDx2aWRlbz48L3ZpZGVvPiB0YWcgaXQgc2hvdWxkIGJlIGFkZGVkIHRvIHRoZSBzcmMgYW5kIHRoZW4gY2FsbCBwbGF5KClcbiAgT25NZWRpYVJlY2lldmVkOiBFdmVudEVtaXR0ZXI8TWVkaWFTdHJlYW0+O1xuXG4gIC8vcHJvcGVydGllc1xuICBwcml2YXRlIFVzZXJBZ2VudDpVQTtcblxuICBwcml2YXRlIEluY29tbWluZ0NhbGxTZXNzaW9uOkludml0ZVNlcnZlckNvbnRleHQ7XG5cbiAgcHJpdmF0ZSBJbkNhbGw6Ym9vbGVhbjtcblxuICBjb25zdHJ1Y3RvcigpIHsgfVxuXG5cbiAgLy9hY2NlcHQgYW4gaW5jb21taW5nIGNhbGxcbiAgYWNjZXB0Q2FsbCgpXG4gIHtcbiAgICBpZih0aGlzLkluY29tbWluZ0NhbGxTZXNzaW9uICE9IHVuZGVmaW5lZClcbiAgICB7XG4gICAgICB0aGlzLkluY29tbWluZ0NhbGxTZXNzaW9uLmFjY2VwdCgpO1xuICAgIH1cbiAgfVxuXG4gIC8vcmVmdXNlIGEgY2FsbCB0aGF0cyBpbmNvbW1pbmdcbiAgcmVmdXNlQ2FsbCgpXG4gIHtcbiAgICBpZih0aGlzLkluY29tbWluZ0NhbGxTZXNzaW9uICE9IHVuZGVmaW5lZClcbiAgICB7XG4gICAgICB0aGlzLkluY29tbWluZ0NhbGxTZXNzaW9uLmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgLy8vc2V0IHRoZSBjb25maWcgZm9yIHRoZSBzaXAsIG1ha2VzIGEgdXNlciBhZ2VudCB0aGF0IHdpbGwgYmUgdXNlZCB0byByZWNpZXZlIGNhbGxzIGFuZCBtb3JlXG4gIHNldENvbmZpZyhjb25maWc6U2lwQ29uZmlnKVxuICB7XG4gICAgIFxuICAgICAgLy9tYWtlIHRoZSBvcHRpb25zXG4gICAgICB2YXIgb3B0aW9uczogVUEuT3B0aW9ucyA9IHtcbiAgICAgICAgdXJpOiBjb25maWcuVXJpLFxuICAgICAgICBhdXRob3JpemF0aW9uVXNlcjogY29uZmlnLlVzZXJOYW1lLFxuICAgICAgICBkaXNwbGF5TmFtZTogY29uZmlnLkRpc3BsYXlOYW1lLFxuICAgICAgICB0cmFuc3BvcnRPcHRpb25zOiB7XG4gICAgICAgICAgd3NTZXJ2ZXJzOiBbY29uZmlnLldlYnNvY2tldFVybF1cbiAgICAgICAgfSxcbiAgICAgICAgcGFzc3dvcmQ6IGNvbmZpZy5QYXNzd29yZFxuICBcbiAgICAgIH07XG4gICAgICAvL2NyZWF0ZSB0aGUgY2xpZW50XG4gICAgICB0aGlzLlVzZXJBZ2VudCA9IG5ldyBVQShvcHRpb25zKTsgXG4gIH1cblxuICAvL3JlZ2lzdGVyIHRoZSBldmVudHMgIG9uIHRoZSB1c2VyIGFnZW50IHdlcmUgaW50ZXJlc3RlZCBpblxuICBwcml2YXRlIHJlZ2lzdGVyQWdlbnRFdmVudHMoKVxuICB7XG4gICAgICB0aGlzLlVzZXJBZ2VudC5vbignaW52aXRlJywoc2Vzc2lvbjpJbnZpdGVTZXJ2ZXJDb250ZXh0KSA9PiB0aGlzLmludml0ZUNhbGxCYWNrKHNlc3Npb24pKTtcbiAgICAgIHRoaXMuVXNlckFnZW50Lm9uKCdyZWdpc3RyYXRpb25GYWlsZWQnLChyZXNwb25zZT86IGFueSxjYXVzZT86IGFueSkgPT4gdGhpcy5yZWdpc3RlckZhaWxlZENhbGxCYWNrKHJlc3BvbnNlLGNhdXNlKSk7XG4gICAgICB0aGlzLlVzZXJBZ2VudC5vbigncmVnaXN0ZXJlZCcsKHJlc3BvbnNlPzogYW55KSA9PiB0aGlzLnJlZ2lzdGVyZWRDYWxsQmFjayhyZXNwb25zZSkpO1xuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3RlcmVkQ2FsbEJhY2socmVzcG9uc2U/OiBhbnkpXG4gIHtcbiAgICBpZih0aGlzLk9uUmVnaXN0ZXJlZCAhPSB1bmRlZmluZWQpXG4gICAge1xuICAgICAgdGhpcy5PblJlZ2lzdGVyZWQuZW1pdCh0cnVlKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyRmFpbGVkQ2FsbEJhY2socmVzcG9uc2U/OiBhbnkscmVhc29uPzogYW55KVxuICB7XG4gICAgaWYodGhpcy5PblJlZ2lzdGVyZWQgIT0gdW5kZWZpbmVkKVxuICAgIHtcbiAgICAgIHRoaXMuT25SZWdpc3RlcmVkLmVtaXQoZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaW52aXRlQ2FsbEJhY2soc2Vzc2lvbjpJbnZpdGVTZXJ2ZXJDb250ZXh0KVxuICB7XG4gICAgaWYoc2Vzc2lvbiAhPSB1bmRlZmluZWQpXG4gICAge1xuICAgICAgdGhpcy5yZWdpc3Rlckludml0ZUV2ZW50cyhzZXNzaW9uKTtcbiAgICAgIHRoaXMuSW5jb21taW5nQ2FsbFNlc3Npb24gPSBzZXNzaW9uOyAgICBcbiAgICAgIHRoaXMuT25JbmNvbW1pbmdDYWxsLm5leHQoc2Vzc2lvbi5jb250YWN0KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVySW52aXRlRXZlbnRzKHNlc3Npb246SW52aXRlU2VydmVyQ29udGV4dClcbiAge1xuICAgICBzZXNzaW9uLm9uKCd0cmFja0FkZGVkJywgKCkgPT4gdGhpcy50cmFja0FkZGVkQ2FsbGJhY2soKSlcbiAgfVxuXG4gIHByaXZhdGUgdHJhY2tBZGRlZENhbGxiYWNrKCkgOiBJbnZpdGVTZXJ2ZXJDb250ZXh0XG4gIHtcbiAgICAvL2NoZWNrIGlmIHRoZSBzZXNzaW9uIGlzbid0IHVuZGVmaW5lZFxuICAgIGlmKHRoaXMuSW5jb21taW5nQ2FsbFNlc3Npb24gIT0gdW5kZWZpbmVkKVxuICAgIHtcblxuICAgICAgLy9nZXQgdGhlIHBlZXJDb25uZWN0aW9uXG4gICAgICB2YXIgcGVlckNvbm5lY3Rpb24gPSB0aGlzLkluY29tbWluZ0NhbGxTZXNzaW9uLnNlc3Npb25EZXNjcmlwdGlvbkhhbmRsZXJbJ3BlZXJDb25uZWN0aW9uJ107XG5cbiAgICAgIC8vbWFrZSBtZWRpYVxuICAgICAgbGV0IG1lZGlhID0gbmV3IE1lZGlhU3RyZWFtKCk7XG5cbiAgICAgICAvL2dldCBhdWRpbyBhbmQgdmlkZW8gdHJhY2sgZnJvbSByZW1vdGVcbiAgICAgIHBlZXJDb25uZWN0aW9uLmdldFJlY2VpdmVycygpLmZvckVhY2goZnVuY3Rpb24gKHJlY2VpdmVyKSB7XG4gICAgICAgIG1lZGlhLmFkZFRyYWNrKHJlY2VpdmVyLnRyYWNrKTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLk9uTWVkaWFSZWNpZXZlZC5lbWl0KG1lZGlhKTtcblxuXG4gICAgICByZXR1cm4gdGhpcy5JbmNvbW1pbmdDYWxsU2Vzc2lvbjtcbiAgICB9XG4gIH1cblxufVxuIl19